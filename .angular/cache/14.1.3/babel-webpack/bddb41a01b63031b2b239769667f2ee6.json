{"ast":null,"code":"import { __extends } from \"tslib\";\nimport { Observable } from '../Observable';\nimport { innerFrom } from '../observable/innerFrom';\nimport { Subject } from '../Subject';\nimport { operate } from '../util/lift';\nimport { OperatorSubscriber } from './OperatorSubscriber';\nexport function groupBy(keySelector, elementOrOptions, duration, connector) {\n  return operate(function (source, subscriber) {\n    var element;\n\n    if (!elementOrOptions || typeof elementOrOptions === 'function') {\n      element = elementOrOptions;\n    } else {\n      duration = elementOrOptions.duration, element = elementOrOptions.element, connector = elementOrOptions.connector;\n    }\n\n    var groups = new Map();\n\n    var notify = function (cb) {\n      groups.forEach(cb);\n      cb(subscriber);\n    };\n\n    var handleError = function (err) {\n      return notify(function (consumer) {\n        return consumer.error(err);\n      });\n    };\n\n    var groupBySourceSubscriber = new GroupBySubscriber(subscriber, function (value) {\n      try {\n        var key_1 = keySelector(value);\n        var group_1 = groups.get(key_1);\n\n        if (!group_1) {\n          groups.set(key_1, group_1 = connector ? connector() : new Subject());\n          var grouped = createGroupedObservable(key_1, group_1);\n          subscriber.next(grouped);\n\n          if (duration) {\n            var durationSubscriber_1 = new OperatorSubscriber(group_1, function () {\n              group_1.complete();\n              durationSubscriber_1 === null || durationSubscriber_1 === void 0 ? void 0 : durationSubscriber_1.unsubscribe();\n            }, undefined, undefined, function () {\n              return groups.delete(key_1);\n            });\n            groupBySourceSubscriber.add(innerFrom(duration(grouped)).subscribe(durationSubscriber_1));\n          }\n        }\n\n        group_1.next(element ? element(value) : value);\n      } catch (err) {\n        handleError(err);\n      }\n    }, function () {\n      return notify(function (consumer) {\n        return consumer.complete();\n      });\n    }, handleError, function () {\n      return groups.clear();\n    });\n    source.subscribe(groupBySourceSubscriber);\n\n    function createGroupedObservable(key, groupSubject) {\n      var result = new Observable(function (groupSubscriber) {\n        groupBySourceSubscriber.activeGroups++;\n        var innerSub = groupSubject.subscribe(groupSubscriber);\n        return function () {\n          innerSub.unsubscribe();\n          --groupBySourceSubscriber.activeGroups === 0 && groupBySourceSubscriber.teardownAttempted && groupBySourceSubscriber.unsubscribe();\n        };\n      });\n      result.key = key;\n      return result;\n    }\n  });\n}\n\nvar GroupBySubscriber = function (_super) {\n  __extends(GroupBySubscriber, _super);\n\n  function GroupBySubscriber() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.activeGroups = 0;\n    _this.teardownAttempted = false;\n    return _this;\n  }\n\n  GroupBySubscriber.prototype.unsubscribe = function () {\n    this.teardownAttempted = true;\n    this.activeGroups === 0 && _super.prototype.unsubscribe.call(this);\n  };\n\n  return GroupBySubscriber;\n}(OperatorSubscriber); //# sourceMappingURL=groupBy.js.map","map":{"version":3,"names":["__extends","Observable","innerFrom","Subject","operate","OperatorSubscriber","groupBy","keySelector","elementOrOptions","duration","connector","source","subscriber","element","groups","Map","notify","cb","forEach","handleError","err","consumer","error","groupBySourceSubscriber","GroupBySubscriber","value","key_1","group_1","get","set","grouped","createGroupedObservable","next","durationSubscriber_1","complete","unsubscribe","undefined","delete","add","subscribe","clear","key","groupSubject","result","groupSubscriber","activeGroups","innerSub","teardownAttempted","_super","_this","apply","arguments","prototype","call"],"sources":["/Users/plamenakichukova/syncron-sdk-components/node_modules/rxjs/dist/esm5/internal/operators/groupBy.js"],"sourcesContent":["import { __extends } from \"tslib\";\nimport { Observable } from '../Observable';\nimport { innerFrom } from '../observable/innerFrom';\nimport { Subject } from '../Subject';\nimport { operate } from '../util/lift';\nimport { OperatorSubscriber } from './OperatorSubscriber';\nexport function groupBy(keySelector, elementOrOptions, duration, connector) {\n    return operate(function (source, subscriber) {\n        var element;\n        if (!elementOrOptions || typeof elementOrOptions === 'function') {\n            element = elementOrOptions;\n        }\n        else {\n            (duration = elementOrOptions.duration, element = elementOrOptions.element, connector = elementOrOptions.connector);\n        }\n        var groups = new Map();\n        var notify = function (cb) {\n            groups.forEach(cb);\n            cb(subscriber);\n        };\n        var handleError = function (err) { return notify(function (consumer) { return consumer.error(err); }); };\n        var groupBySourceSubscriber = new GroupBySubscriber(subscriber, function (value) {\n            try {\n                var key_1 = keySelector(value);\n                var group_1 = groups.get(key_1);\n                if (!group_1) {\n                    groups.set(key_1, (group_1 = connector ? connector() : new Subject()));\n                    var grouped = createGroupedObservable(key_1, group_1);\n                    subscriber.next(grouped);\n                    if (duration) {\n                        var durationSubscriber_1 = new OperatorSubscriber(group_1, function () {\n                            group_1.complete();\n                            durationSubscriber_1 === null || durationSubscriber_1 === void 0 ? void 0 : durationSubscriber_1.unsubscribe();\n                        }, undefined, undefined, function () { return groups.delete(key_1); });\n                        groupBySourceSubscriber.add(innerFrom(duration(grouped)).subscribe(durationSubscriber_1));\n                    }\n                }\n                group_1.next(element ? element(value) : value);\n            }\n            catch (err) {\n                handleError(err);\n            }\n        }, function () { return notify(function (consumer) { return consumer.complete(); }); }, handleError, function () { return groups.clear(); });\n        source.subscribe(groupBySourceSubscriber);\n        function createGroupedObservable(key, groupSubject) {\n            var result = new Observable(function (groupSubscriber) {\n                groupBySourceSubscriber.activeGroups++;\n                var innerSub = groupSubject.subscribe(groupSubscriber);\n                return function () {\n                    innerSub.unsubscribe();\n                    --groupBySourceSubscriber.activeGroups === 0 &&\n                        groupBySourceSubscriber.teardownAttempted &&\n                        groupBySourceSubscriber.unsubscribe();\n                };\n            });\n            result.key = key;\n            return result;\n        }\n    });\n}\nvar GroupBySubscriber = (function (_super) {\n    __extends(GroupBySubscriber, _super);\n    function GroupBySubscriber() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.activeGroups = 0;\n        _this.teardownAttempted = false;\n        return _this;\n    }\n    GroupBySubscriber.prototype.unsubscribe = function () {\n        this.teardownAttempted = true;\n        this.activeGroups === 0 && _super.prototype.unsubscribe.call(this);\n    };\n    return GroupBySubscriber;\n}(OperatorSubscriber));\n//# sourceMappingURL=groupBy.js.map"],"mappings":"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"},"metadata":{},"sourceType":"module"}